---
title: "Preprints"
author: "Matthias Mittner"
date: "today"
---

```{r setup, cache=F, include=FALSE}
library(tidyverse)
library(lubridate)
library(glue)
library(DT)
library(openalexR)
source("../lib/functions.R")

# Your ORCID
MY_ORCID <- "0000-0003-0205-7353"
```

```{r, cache=F, include=FALSE}
## Fetch all preprints from OpenAlex by ORCID
## This automatically finds preprints from PsyArXiv, bioRxiv, and other preprint servers
preprints <- get_preprints_openalex(MY_ORCID)

# Build citation strings
preprints$citation <- ""
if(nrow(preprints) > 0) {
  for(i in 1:nrow(preprints)){
    authors <- preprints[i,]$authors[[1]]
    if(is.null(authors) || nrow(authors) == 0){
      latexauth <- "Unknown"
    } else if(nrow(authors) == 1){
      latexauth <- glue_data(authors, "**{family_name}, {str_sub(given_name, 1,1)}.**")
    } else {
      latexauth <- glue_data(authors, "{family_name}, {str_sub(given_name, 1,1)}.")
      latexauth <- if_else(
        startsWith(latexauth, "Mittner") | startsWith(latexauth, "Ihrke"),
        sprintf("**%s**", latexauth),
        as.character(latexauth)
      )
      latexauth <- glue_collapse(latexauth, sep = ", ", last = " & ")
    }
    ref <- with(preprints[i,], glue("{latexauth} ({date}). {title}. [{source}]({link})"))
    preprints$citation[i] <- ref
  }
}

preprints %>% arrange(desc(date)) -> preprints
```


This is a list of all preprints published by my group, so far. The preprints for which the status is "published" all have a corresponding publication on my [publication list](/publications.qmd).

```{r, echo=F, results='asis'}
#| column: screen-inset-shaded
mdtohtml <- function(x){
  purrr::map_chr(x, function(y){
    markdown::markdownToHTML(text=y, fragment.only = T)
  })
}

d <- preprints %>%
  select(date, citation, source, link) %>%
  mutate(
    link = mdtohtml(sprintf("[link](%s)", link)),
    citation = mdtohtml(citation)
  )
DT::datatable(d, escape = F, colnames = c("Date", "Citation", "Source", "Link"))
```